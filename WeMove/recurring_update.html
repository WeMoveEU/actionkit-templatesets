{% extends "./wrapper.html" %}
{% load humanize %}

{% block css_additions %}
{{ super }}
{% endblock %}

{% block content %}

<div class="ak-grid-row">
    <div class="ak-grid-col ak-grid-col-12-of-12">
        <h2>{{ page.title }}</h2>
    </div>
</div>

<div class="ak-grid-row ak-grid-row-inverted">
    {% if page.custom_fields.featured_image %}
        <div class="ak-grid-col ak-grid-col-3-of-12">
            <img class="ak-featured-img" src="{{page.custom_fields.featured_image}}" alt="main picture" />
        </div>
    {% endif %}
    <div class="ak-grid-col {% if page.custom_fields.featured_image %} ak-grid-col-9-of-12 {% else %}ak-grid-col-12-of-12 {% endif %}">

        <div>
            <p>Logged in as <a href="/me/">{{ logged_in_user.name }}</a>. <a href="/logout/">Log out</a></p>
        </div>
        <div style="display:none">{% comment %}actionkit.js wants this, but we don't{% endcomment %}
            <p id="unknown_user"></p>
            <div id="known_user"><span id="known_user_name"></span></div>
        </div>
        {% if action %}
            <h3>Update saved!</h3>
            <div>
                {% include_tmpl form.thank_you_text %}
            </div>
        {% endif %}

        <p>{% include_tmpl form.update_card_text %}</p>

        {% comment %}
        <ul>
        {% for profile in actionkit_user.lazy_recurring_orders %}
        <li>{{ profile.status }} on {{ profile.updated_at }}. Started on {{ profile.start }}, {% with profile.payment_count as count %} {{ count }} {{ profile.get_period_display|lower }} payment{{ count|pluralize }}{% endwith %} were made for a total of {{ profile.payment_total_amt }}.</li>
        {% endfor %}
        </ul> {% endcomment %}

        {% record "init" in active_recurring %}
        {% record "init" in other_recurring %}

        {% for profile in actionkit_user.lazy_recurring_orders %}
            {% if profile.status == 'active' or profile.status == 'past_due' %}
                {% record profile in active_recurring %}
            {% else %}
                {% record profile in other_recurring %}
            {% endif %}
        {% endfor %}

        {% with profile.payment_processor_information as pp %}

            Monthly recurring:

            {% for profile in active_recurring|slice:"1:" %}
            <form id="change_profile_{{ profile.id }}">
                <p>{{ profile.status }} for {{ profile.payment_total_amt }}</p>
                {{ profile.as_dict }}

                <div data-wm-form-field="first_name" id="ak-fieldbox-first_name" class="form-field required ak-err-below">
                    <label for="id_first_name" class="ak-is-overlaid ak-error" style="cursor: text; pointer-events: none;">
                        Name:<span class="ak-required-flag">*</span>
                    </label>
                    <input type="text" name="first_name" id="id_first_name" class="ak-userfield-input ak-has-overlay ak-error">
                    <ul class="ak-err" style="display: block;">
                        <li>Name required</li>
                    </ul>
                </div>
            </form>
            {% empty %}
                <p>Whoops! You don't have any active recurring donations to update.</p>
            {% endfor %}

        {% endwith %}

        <hr>

        Past recurring:
        <ul>
            {% for profile in other_recurring|slice:"1:" %}
            <li>{{ profile.status }} on {{ profile.updated_at }}. Started on {{ profile.start }}, {% with profile.payment_count as count %} {{ count }} {{ profile.get_period_display|lower }} payment{{ count|pluralize }}{% endwith %} were made for a total of {{ profile.payment_total_amt }}.</li>
            {% empty %}
            <p> You have no inactive recurring donations </p>
            {% endfor %}
        </ul>


        {{ active_recurring }}

        {% comment %} {% if not active_recurring %}
            <p>Whoops! You don't have any active recurring donations to update.</p>
        {% else %}
            {% for profile in active_recurring %} {% endcomment %}
            {% comment %} {% for profile in active_recurring %}
                {{profile.as_dict}}
            {% endfor %} {% endcomment %}
        {% comment %} {% endif %} {% endcomment %}

        {% comment %}
            This is an example of how to show inactive profiles.
            {% if inactive %}

                <label class="ak-label-above">Your old, no longer active recurring donations</label>
                <ul>
                    {% for profile in inactive %}
                    <li>{{ profile.status }} on {{ profile.updated_at }}. Started on {{ profile.start }}, {% with profile.payment_count as count %} {{ count }} {{ profile.get_period_display|lower }} payment{{ count|pluralize }}{% endwith %} were made for a total of {{ profile.payment_total_amt }}.</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endcomment %}

    </div>
</div>

{% log_context %}

{% endblock %}