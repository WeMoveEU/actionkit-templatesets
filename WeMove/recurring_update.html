{% extends "./wrapper.html" %}
{% load humanize %}

{% block css_additions %}
<link rel="stylesheet" href="https://donate-ui.not-a2.eu/assets/donate-main.css" />

{% endblock %}

{% block script_additions %}
{% endblock %}

{% block content %}

<div class="ak-grid-row">
    <div class="ak-grid-col ak-grid-col-12-of-12">
        <h2>{{ page.title }}</h2>
    </div>
</div>

{% comment %}
TODO:

- active has nothing in it even for users that have active recurring donations
- inactive has some

{% endcomment %}
<div class="ak-grid-row ak-grid-row-inverted">
    {% if page.custom_fields.featured_image %}
        <div class="ak-grid-col ak-grid-col-3-of-12">
            <img class="ak-featured-img" src="{{page.custom_fields.featured_image}}" alt="main picture" />
        </div>
    {% endif %}
    <div class="ak-grid-col {% if page.custom_fields.featured_image %} ak-grid-col-9-of-12 {% else %}ak-grid-col-12-of-12 {% endif %}">

        <div>
            <p>Hello {{ logged_in_user.name }} ! If you're not {{ logged_in_user.name }}, please <a href="/logout/">click here.</a></p>
        </div>

        <div style="display:none">{% comment %}actionkit.js wants this, but we don't{% endcomment %}
            <p id="unknown_user"></p>
            <div id="known_user"><span id="known_user_name"></span></div>
        </div>

        <p>{% include_tmpl form.update_card_text %}</p>

        {% if action %}
            <h3>Update saved!</h3>
            <div>
                {% include_tmpl form.thank_you_text %}
            </div>
        {% else %}

            {% for amount in args.amounts|split:',' %}
                <div style="padding: 1em;">
                <div
                    class="donate-widget"
                    data-ak_locale="en"
                    data-akid="{{ logged_in_user.token }}"
                    data-mode="change"
                    data-recurring_id="{{ args.profile }}"
                    data-change_amount="{{ amount }}"
                    data-selected_currency="{{ args.currency }}"
                    ></div>
                </div>
            {% endfor %}


        {% endif %}


        <div id="active-donations">
        </div>


        {% comment %}

        OK, the code below  gets the current user's active recurring donations, but it has
        a few problems before we can do anything interesting like "Hey Bob! You currently
        have a monthly/weekly donation for X that started on Y and you've given Z total!"

        - a field to tell if the donation is weekly / monthly needs to be added in the report
        - translations need to be added

        So totally doable if we need it.

        <script>
        const donations = [{% report "recurring_donations_for_user" with logged_in_user.id as user_id "active" as status args.t as cache_key %}];
        const subscriptions = donations[0];
        let info = '<ul>';
        const fields = subscriptions[0];
        for (var i=1; i<subscriptions.length; i++) {
            const d = {};
            for (var x=0;x<fields.length;x++) {
                d[fields[x]] = subscriptions[i][x]
            }
            info += `<b>${d.recurring_id}</b>`;
        }
        info += '</ul>';
        document.getElementById('active-donations').innerHTML = info;
        </script> {% endcomment %}



        {% comment %}
            This is an example of how to show inactive profiles.
            {% if inactive %}


                <label class="ak-label-above">Your old, no longer active recurring donations</label>
                <ul>
                    {% for profile in inactive %}
                    <li>{{ profile.id }} - {{ profile.status }} on {{ profile.updated_at }}. Started on {{ profile.start }}, {% with profile.payment_count as count %} {{ count }} {{ profile.get_period_display|lower }} payment{{ count|pluralize }}{% endwith %} were made for a total of {{ profile.payment_total_amt }}.</li>
                    {% endfor %}
                </ul>
            {% endif %}

        {% endcomment %}

    </div>

</div>
<script type="module" src="https://donate-ui.not-a2.eu/assets/donate-main.js"></script>
{% endblock %}
