{% extends "./wrapper.html" %}

{% block content %}

{% if page.custom_fields.consent_version %}
  {% include "./consent.html" %}
{% elif page.custom_fields.sharing_step %}
  {% if args.akid and args.akid|first = 's' %}
    {% if "//" in page.custom_fields.sharing_step %}
      {% store as link %}{{ page.custom_fields.sharing_step }}{% endstore %}
      {% remember link as target %}
    {% elif page.custom_fields.daisy_chain_action %}
      {% store as link %}/act/{{ page.custom_fields.daisy_chain_action }}?akid={{ args.akid }}{% endstore %}
      {% remember link as target %}
    {% else %}
      {% store as link %}/thanks/{{ page.name }}?share=1&akid={{ args.akid }}{% endstore %}
      {% remember link as target %}
    {% endif %}
    <a href="{{ target }}">Please continue to the next step.</a>
    <script>
      window.location = '{{ target }}';
    </script>
  {% else %}
    {% remember "1" as share_mode %}
    {% remember "1" as isEmbbeded %}
    {% include "./thanks.html" %}

    {% if page.custom_fields.next_step %}
    <script>
      (()=>{
        document.querySelector('[data-wm-skip-button]').href = '/act/{{ page.custom_fields.next_step }}';
      })();
    </script>
    {% endif %}
  {% endif %}
{% else %}

<div class="nav-md:grid grid-cols-petition">
  <article>
    <div class="relative">
      {% include "./language_picker.html" %}
      <h1 class="text-4xl mb-8 pr-40 nav-md:text-5xl">{{ page.title }}</h1>
    </div>

    {% include "./component-featured_media.html" %}

    <div class="nav-md:mr-4">
      <div class="text-wm-purple p-6 bg-wm-lightblue-box mt-4 mb-8 font-normal text-base font-libre-franklin">
        {% filter ak_text:"singup_well" %}I stand for a better Europe; for a European Union committed to social and economic justice, environmental sustainability and citizen-led democracy.{% endfilter %}
      </div>

      {% include_tmpl form.introduction_text %}
    </div>

    {% include "./component-recent_actions.html" %}
  </article>

  <aside>
    <form
      class="ak-form ak-styled-fields ak-labels-overlaid ak-errs-below is-floating
      bg-wm-bg-form p-4 h-fit mx-auto max-w-[500px]"
      name="act"
      method="post"
      action="/act/"
      accept-charset="utf-8"
      data-wm-floating-labels-form
      data-wm-pixel-event-type="Subscribe"
      data-wm-pixel-track-type="track"
      data-wm-pixel-trigger-event="submit">
      <input type="hidden" name="page" value="{{ page.name }}" />

      <div id="petition-form" class="form-wrapper-container">
        {% include "./user_form_wrapper.html" %}

        <div class="form-field hide-if-previously-signed mb-4">
          <button type="submit" class="button--primary">
            {% if page.custom_fields.sign_petition_button %}
              {{ page.custom_fields.sign_petition_button }}
            {% else %}
              {% filter ak_text:"button_sign_petition" %}
                I'm joining!
              {% endfilter %}
            {% endif %}
          </button>
        </div>

        <div class="privacy-statement hide-if-previously-signed">
          {% store as consent_text %}{% report "signup_text_for_list_language" with 1 as refresh page.list_id as list_id page.lang_id|default:100 as lang_id %}{% endstore %}
          {{ consent_text }}
        </div>
      </div>
    </form>

    {% include "./component-recent_comments.html" %}
  </aside>
</div>

{% endif %}

{% endblock %}
